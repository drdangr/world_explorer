# Правила разработки UI на основе лучших практик

## Доступность (A11y)

### Обязательные требования
- Все интерактивные элементы должны иметь `aria-label` или `aria-labelledby`
- Используйте семантические HTML элементы (`<button>`, `<nav>`, `<main>`, `<section>`, `<header>`, `<footer>`)
- Для модальных окон: `role="dialog"`, `aria-modal="true"`, `aria-labelledby`, `aria-describedby`
- Все изображения и иконки должны иметь `aria-hidden="true"` если декоративные, или `alt` текст если информативные
- Поддерживайте навигацию с клавиатуры: Tab, Enter, Escape, Arrow keys где уместно
- Используйте `useId()` для генерации уникальных ID для aria-атрибутов

### Фокус и навигация
- Все фокусируемые элементы должны иметь видимый focus ring: `focus:outline-none focus:ring-2 focus:ring-emerald-400/50`
- Порядок табуляции должен быть логичным и интуитивным
- Модальные окна должны ловить фокус и возвращать его при закрытии
- Отключайте body scroll при открытии модальных окон

### Контрастность
- Минимальный контраст текста: 4.5:1 для обычного текста, 3:1 для крупного текста (18px+)
- Используйте `text-slate-100` для основного текста на `bg-slate-950`
- Для вторичного текста: `text-slate-400` или `text-slate-500`
- Акцентные цвета (emerald) должны иметь достаточный контраст

## Адаптивность и Responsive Design

### Брейкпоинты Tailwind
- `sm:` 640px - планшеты в портретной ориентации
- `md:` 768px - планшеты в альбомной ориентации
- `lg:` 1024px - ноутбуки
- `xl:` 1280px - десктопы
- `2xl:` 1536px - большие экраны

### Мобильная адаптация
- Используйте `flex-col` на мобильных, `flex-row` на десктопе
- Минимальная ширина кликабельных элементов: 44x44px (iOS HIG)
- Панели должны быть скроллируемыми: `overflow-y-auto` с `min-h-0` для flex-контейнеров
- Модальные окна должны иметь отступы: `p-4` на мобильных
- Используйте `truncate` для длинного текста с `title` атрибутом для полного текста

### Гибкие контейнеры
- Используйте `min-h-0` для flex-элементов внутри flex-контейнеров для правильного overflow
- Применяйте `flex-1` для элементов, которые должны занимать доступное пространство
- Используйте `min-w-0` для предотвращения переполнения flex-элементов

## Состояния и обратная связь

### Состояния интерактивных элементов
- **Default**: базовые стили с границами и фоном
- **Hover**: `hover:border-emerald-400/60 hover:text-emerald-200` для акцентов
- **Focus**: видимый focus ring
- **Active**: легкое изменение opacity или scale при клике
- **Disabled**: `disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-700`
- **Loading**: показывайте индикатор загрузки и блокируйте взаимодействие

### Визуальная обратная связь
- Используйте `transition` для плавных изменений состояний
- Анимации должны быть быстрыми (150-300ms) и естественными
- Показывайте состояние загрузки: "ГМ отвечает…", спиннеры, скелетоны
- Отображайте ошибки с красным акцентом: `border-red-500/40 bg-red-500/10 text-red-200`
- Успешные действия: зеленый акцент `border-emerald-400/60 bg-emerald-400/10`

### Пустые состояния
- Всегда показывайте понятные пустые состояния с описанием и возможным действием
- Используйте `border-dashed` для визуального разделения пустых областей
- Предлагайте действия: "Создайте первый мир, чтобы начать приключение"

## Цветовая схема и визуальная иерархия

### Цветовая палитра (темная тема)
- **Фон**: `bg-slate-950` основной, `bg-slate-950/60` для панелей, `bg-slate-950/20` для секций
- **Границы**: `border-slate-800` основные, `border-slate-700` для hover
- **Текст**: `text-slate-100` основной, `text-slate-300` вторичный, `text-slate-400` третичный, `text-slate-500` метаданные
- **Акцент**: `emerald-400` для основных действий, `emerald-300` для hover
- **Ошибки**: `red-500/40` границы, `red-500/10` фон, `red-200` текст

### Визуальная иерархия
- Заголовки: `text-lg font-semibold` для h2, `text-base font-semibold` для h3
- Подзаголовки: `text-sm text-slate-400`
- Метаданные: `text-xs text-slate-500` или `text-[11px]`
- Используйте `uppercase tracking-wide` для меток и категорий
- Разделители: `border-b border-slate-800`

## Типографика

### Размеры шрифтов
- Заголовки: `text-lg` (18px), `text-base` (16px), `text-sm` (14px)
- Основной текст: `text-sm` (14px)
- Вторичный текст: `text-xs` (12px)
- Мелкий текст: `text-[11px]` или `text-[10px]` для метаданных

### Стили текста
- Веса: `font-medium` для акцентов, `font-semibold` для заголовков
- Межстрочный интервал: `leading-relaxed` для длинного текста
- Переносы: `whitespace-pre-line` для многострочного текста с переносами
- Обрезка: `truncate` с `title` атрибутом для tooltip

## Формы и валидация

### Поля ввода
- Используйте `textarea` для многострочного ввода с `min-h-[60px]` и `resize-none`
- Поля должны иметь четкие границы: `border border-slate-700`
- Focus состояние: `focus:border-slate-500 focus:outline-none`
- Placeholder: `placeholder:text-slate-500`
- Disabled состояние: `disabled:cursor-not-allowed disabled:opacity-50`

### Валидация
- Показывайте ошибки валидации сразу после blur или submit
- Ошибки должны быть визуально заметными и понятными
- Используйте `required` атрибут для обязательных полей
- Блокируйте submit при невалидных данных

### Кнопки отправки
- Основная кнопка: `bg-emerald-300 text-emerald-900 hover:bg-emerald-200`
- Disabled: `disabled:cursor-not-allowed disabled:bg-slate-700 disabled:text-slate-400`
- Показывайте состояние загрузки в тексте кнопки

## Интерактивность и анимации

### Переходы
- Используйте `transition` для всех интерактивных изменений
- Длительность: 150-300ms для большинства переходов
- Easing: `ease-in-out` или `ease` по умолчанию Tailwind

### Анимации
- Избегайте излишних анимаций, они должны быть функциональными
- Используйте `transform` и `opacity` для производительных анимаций
- Для drag & drop: `opacity-60` при перетаскивании
- Для переключений: плавное перемещение с `transition-all`

### Интерактивные элементы
- Кнопки должны иметь достаточный padding: `px-3 py-2` минимум
- Иконки в кнопках: `h-4 w-4` для маленьких, `h-5 w-5` для средних
- Группируйте связанные действия визуально

## Навигация и структура

### Структура страницы
- Используйте семантические секции: `<header>`, `<main>`, `<aside>`, `<footer>`
- Логическая структура заголовков (h1 → h2 → h3)
- Breadcrumbs для глубокой навигации (если применимо)

### Модальные окна
- Используйте порталы (`createPortal`) для рендеринга вне DOM-дерева
- Backdrop: `bg-slate-950/80 backdrop-blur-sm`
- Закрытие по Escape и клику на backdrop
- Блокировка body scroll при открытии
- Фокус должен быть внутри модального окна

### Панели и боковые панели
- Фиксированная ширина для sidebar: `min-w-[16rem] max-w-md`
- Скроллируемый контент: `overflow-y-auto` с `flex-1 min-h-0`
- Разделители между секциями: `border-b border-slate-800`

## Производительность

### Оптимизация рендеринга
- Используйте `useMemo` для дорогих вычислений
- Используйте `useCallback` для функций, передаваемых в дочерние компоненты
- Разбивайте большие компоненты на меньшие
- Используйте `React.memo` для компонентов, которые редко меняются

### Ленивая загрузка
- Используйте динамический импорт для тяжелых компонентов: `dynamic(() => import(...))`
- Ленивая загрузка изображений с `loading="lazy"`

### Виртуализация
- Для длинных списков используйте виртуализацию (react-window, react-virtual)
- Ограничивайте количество одновременно отображаемых элементов

## UX паттерны

### Обратная связь пользователю
- Показывайте прогресс для долгих операций
- Используйте toast-уведомления для успешных действий и ошибок
- Подтверждайте деструктивные действия: `window.confirm()` или модальное окно

### Обработка ошибок
- Показывайте понятные сообщения об ошибках
- Предлагайте действия для исправления ошибок
- Не блокируйте весь интерфейс из-за одной ошибки

### Загрузка данных
- Показывайте скелетоны или спиннеры во время загрузки
- Используйте оптимистичные обновления где возможно
- Кэшируйте данные для быстрого отображения

### Пустые состояния
- Всегда объясняйте, почему область пуста
- Предлагайте действия для заполнения
- Используйте иконки или иллюстрации для визуального интереса

## Специфичные паттерны проекта

### Граф и визуализация
- Ноды должны быть перетаскиваемыми с сохранением позиций
- Показывайте визуальные индикаторы для текущей позиции игрока
- Анимируйте переходы между локациями
- Используйте цветовое кодирование для разных типов нод

### Чат-панель
- Автопрокрутка к последнему сообщению при новых сообщениях
- Визуальное разделение сообщений игрока и ГМ
- Показывайте предложения действий как кликабельные чипсы
- Индикатор печати/обработки для ответов ГМ

### Drag & Drop
- Используйте `@dnd-kit` для перетаскивания
- Визуальная обратная связь при перетаскивании: opacity, transform
- Ограничивайте направления перетаскивания где необходимо
- Минимальное расстояние активации: 6px для предотвращения случайных перетаскиваний

## Компоненты и переиспользование

### Структура компонентов
- Разделяйте логику и представление
- Используйте составные компоненты для сложных UI
- Создавайте переиспользуемые компоненты для повторяющихся паттернов

### Иконки
- Используйте SVG иконки как React компоненты
- Единый размер: `h-4 w-4` для маленьких, `h-5 w-5` для средних
- Всегда добавляйте `aria-hidden="true"` для декоративных иконок
- Используйте `currentColor` для stroke/fill для наследования цвета

### Модальные окна
- Переиспользуемый компонент `Modal` с настраиваемыми размерами
- Всегда передавайте `title` и опционально `description`
- Используйте `onClose` callback для закрытия

## Тестирование и качество

### Проверка доступности
- Тестируйте с клавиатурной навигацией
- Проверяйте контрастность цветов
- Используйте screen readers для проверки
- Проверяйте фокус-менеджмент в модальных окнах

### Кроссбраузерность
- Тестируйте в Chrome, Firefox, Safari
- Проверяйте работу на мобильных устройствах
- Учитывайте различия в рендеринге Tailwind классов

## Стиль кода

### Именование
- Компоненты: PascalCase (`ChatPanel`, `GraphPanel`)
- Функции: camelCase (`handleSubmit`, `onNodesChange`)
- Константы: UPPER_SNAKE_CASE (`NODE_RADIUS`, `FORCE_TICKS`)

### Структура компонента
```typescript
// 1. Импорты
// 2. Типы и интерфейсы
// 3. Константы
// 4. Основной компонент
// 5. Вспомогательные функции
// 6. Подкомпоненты
// 7. Иконки и утилиты
```

### Tailwind классы
- Группируйте классы логически: layout → spacing → typography → colors → effects
- Используйте условные классы через template literals для динамических стилей
- Предпочитайте Tailwind утилиты инлайн-стилям
- Используйте `satisfies` для type safety где возможно

## Дополнительные рекомендации

### Темная тема
- Всегда используйте темную тему как основную
- Проверяйте читаемость всех цветовых комбинаций
- Используйте полупрозрачные фоны для слоев: `/20`, `/40`, `/60`, `/80`

### Анимации и переходы
- Избегайте анимаций для пользователей с `prefers-reduced-motion`
- Используйте `@media (prefers-reduced-motion: reduce)` для отключения анимаций

### Производительность
- Минимизируйте количество ре-рендеров
- Используйте React DevTools Profiler для оптимизации
- Избегайте создания объектов/массивов в render без мемоизации

### Безопасность
- Валидируйте все пользовательские вводы
- Санитизируйте данные перед отображением
- Используйте `type="button"` для кнопок вне форм

