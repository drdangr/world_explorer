# World Explorer

World Explorer — веб‑приложение для интерактивных текстовых путешествий по генерируемым мирам. Игрок создаёт персонажей, выбирает или формирует мир с уникальными сеттингом, атмосферой и жанром, а затем взаимодействует с Гейм‑мастером (LLM), исследуя локации, предметы и связи между ними.

## Архитектура и Модули

Проект построен на современном стеке технологий с акцентом на модульность и расширяемость.

### Технологический стек
- **Framework**: Next.js 15 (App Router)
- **UI**: React 19, Tailwind CSS, Lucide React
- **State Management**: Zustand (Slice Pattern)
- **Visualization**: React Flow v12 (@xyflow/react)
- **AI**: Google Gemini API
- **Data**: Supabase (PostgreSQL) + JSON (Local Dev/Sessions)

### Модульная структура (`src/`)

#### 1. Store (`src/store/`)
Состояние приложения управляется через Zustand и разделено на независимые слайсы:
- **`worldSlice`**: Управление мирами (CRUD, выбор текущего мира).
- **`characterSlice`**: Управление персонажами.
- **`sessionSlice`**: Логика игровой сессии, история сообщений, обработка ходов.
- **`gameStore.ts`**: Точка сборки всех слайсов в единый хук `useGameStore`.

#### 2. API Layer (`src/services/api/`)
Слой абстракции для взаимодействия с бэкендом. Отделяет бизнес-логику от компонентов и стейта.
- **`worlds.ts`**, **`characters.ts`**, **`sessions.ts`**: Типизированные функции для запросов к API.

#### 3. Features (`src/features/`)
UI-компоненты сгруппированы по функциональным областям:
- **`dashboard`**: Основной игровой интерфейс (панели, модальные окна).
- **`graph`**: Визуализация карты мира на базе React Flow.
- **`chat`**: Интерфейс взаимодействия с ГМ.

#### 4. Lib (`src/lib/`)
Ядро бизнес-логики и инфраструктурный код:
- **`llm`**: Адаптеры для работы с LLM (Gemini, Mock).
- **`repository`**: Слой доступа к данным (Supabase, File System).
- **`gameplay`**: Игровая механика (обработка ходов, инвентарь).

---

## Data Flow (Поток данных)

Архитектура следует однонаправленному потоку данных:

1.  **User Interaction**: Пользователь совершает действие в UI (например, отправляет сообщение).
2.  **Store Action**: Вызывается экшен из `useGameStore` (например, `submitAction`).
3.  **API Service**: Экшен вызывает функцию из `src/services/api` (например, `processTurn`).
4.  **Next.js API Route**: Запрос уходит на серверный эндпоинт (`/api/session`).
5.  **Repository**: Эндпоинт обращается к репозиторию для чтения/записи данных.
6.  **LLM Processing**: При необходимости вызывается LLM для генерации ответа.
7.  **State Update**: Результат возвращается на клиент и обновляет Zustand Store.
8.  **UI Render**: Интерфейс перерисовывается с новыми данными.

---

## Хранение и Обработка Данных

### Гибридное хранение
- **Миры и Персонажи**: Хранятся в Supabase (или `data/*.json` в локальном режиме) для быстрого доступа и связности.
- **Игровые Сессии**: Хранятся в JSON-файлах (`data/sessions/`). Это позволяет вести длинные логи без перегрузки базы данных и легко делать бэкапы историй.

### Принципы обработки
- **Асинхронность**: Все тяжелые операции (генерация текста, работа с БД) вынесены на сервер (Next.js API Routes).
- **Валидация**: Данные валидируются с помощью Zod как на клиенте, так и на сервере.
- **Оптимистичные обновления**: UI может обновляться мгновенно, ожидая подтверждения от сервера (где применимо).

---

## Быстрый старт

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev
```

Приложение будет доступно по адресу `http://localhost:3000`.

### Настройка окружения (.env.local)
```env
GEMINI_API_KEY=your_key_here
LLM_PROVIDER=gemini # или mock
```
